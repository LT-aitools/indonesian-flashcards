<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indonesian Flashcards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
        button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #correct { background-color: lightgreen; }
        #sorta { background-color: lightsalmon; }
        #incorrect { background-color: lightcoral; }
        #reveal { background-color: yellow; }
        #correct, #sorta, #incorrect, #example { display: none; }
        #answer { color: green; font-size: 20px; margin-top: 10px; }
        #exampleSentence { color: blue; font-size: 18px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1 style="color: lightgrey; margin-bottom: 20px;">Indonesian Flashcard Game</h1>
    <h2 id="question">Loading...</h2>
    <h3 id="answer"></h3>
    <h3 id="exampleSentence"></h3>
    <button id="hint1">Hint 1</button>
    <button id="hint2">Hint 2</button>
    <button id="reveal">Reveal üëÄ</button>
    <br>
    <button id="correct">Correct ‚úÖ</button>
    <button id="sorta">Sorta ü´§</button>
    <button id="incorrect">Incorrect ‚ùå</button>
    <button id="example">Example</button>

    <script>
        const vocabulary = [];
        let currentWordIndex = 0;
        let incorrectWords = [];
        
        const azureApiKey = "5hTwF87ZlTwAE4Koj0yi9yzaIUh8AF0rCTgpoizyxyI0lgudcTkDJQQJ99BCACYeBjFXJ3w3AAAYACOGgTlf";
        const azureRegion = "eastus";

        async function loadCSV() {
            const response = await fetch('Indonesian_vocabulary.csv');
            const data = await response.text();
            parseCSV(data);
        }

        function parseCSV(data) {
            const rows = data.split('\n').map(row => row.split(','));
            rows.shift();
            rows.forEach(row => {
                vocabulary.push({
                    english: row[1],
                    indonesian: row[2],
                    exampleSentence: row[3]
                });
            });
            startGame();
        }

        function startGame() {
            shuffleArray(vocabulary);
            showNextWord();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showNextWord() {
            if (currentWordIndex >= vocabulary.length) {
                alert("You've completed all words!");
                return;
            }

            const wordData = vocabulary[currentWordIndex];
            if (!wordData) return;

            speakWord(wordData.english, "en-US");

            document.getElementById("question").innerText = wordData.english;
            document.getElementById("answer").innerText = "";
            document.getElementById("exampleSentence").innerText = "";

            document.getElementById("hint1").style.display = "inline";
            document.getElementById("hint2").style.display = "inline";
            document.getElementById("reveal").style.display = "inline";

            document.getElementById("example").style.display = "none";
            document.getElementById("correct").style.display = "none";
            document.getElementById("sorta").style.display = "none";
            document.getElementById("incorrect").style.display = "none";

            document.getElementById("hint1").onclick = () => showHint(1);
            document.getElementById("hint2").onclick = () => showHint(2);
            document.getElementById("reveal").onclick = revealAnswer;
            document.getElementById("example").onclick = showExample;
            document.getElementById("correct").onclick = markCorrect;
            document.getElementById("sorta").onclick = markSorta;
            document.getElementById("incorrect").onclick = markIncorrect;
        }

        function revealAnswer() {
            const wordData = vocabulary[currentWordIndex];

            document.getElementById("answer").innerText = wordData.indonesian;

            document.getElementById("hint1").style.display = "none";
            document.getElementById("hint2").style.display = "none";
            document.getElementById("reveal").style.display = "none";

            document.getElementById("example").style.display = "inline";
            document.getElementById("correct").style.display = "inline";
            document.getElementById("sorta").style.display = "inline";
            document.getElementById("incorrect").style.display = "inline";

            speakWord(wordData.indonesian, "id-ID");
        }

        function showExample() {
            const wordData = vocabulary[currentWordIndex];

            const [indoPart, engPart] = wordData.exampleSentence.split(" - ");
            document.getElementById("exampleSentence").innerText = wordData.exampleSentence;

            if (indoPart) {
                speakWord(indoPart, "id-ID").then(() => {
                    if (engPart) speakWord(engPart, "en-US");
                });
            } else if (engPart) {
                speakWord(engPart, "en-US");
            }
        }

        function showHint(level) {
            const wordData = vocabulary[currentWordIndex];

            if (level === 1) {
                document.getElementById("hint1").innerText = `First letter: ${wordData.indonesian.charAt(0)}`;
            } else if (level === 2) {
                document.getElementById("hint2").innerText = `Hint: ${wordData.indonesian.charAt(0)}${"-".repeat(wordData.indonesian.length - 1)}`;
            }
        }

        function markCorrect() {
            currentWordIndex++;
            showNextWord();
        }

        function markSorta() {
            currentWordIndex++;
            showNextWord();
        }

        function markIncorrect() {
            incorrectWords.push(vocabulary[currentWordIndex]);
            currentWordIndex++;
            showNextWord();
        }

        async function speakWord(word, lang) {
            return new Promise(async (resolve) => {
                const audio = new SpeechSynthesisUtterance(word);
                audio.lang = lang;
                audio.onend = resolve;
                speechSynthesis.speak(audio);
            });
        }

        window.onload = loadCSV;
    </script>
</body>
</html>
